<input type="hidden" id="${entry.idEntry}_map_provider" name="${entry.idEntry}_map_provider" value="${entry.gismapProvider.key}"/>
<div class="form-element" id="${entry.idEntry}_waiting" style="display:none;">
  <span class="form-label">
	<label for="">&nbsp;</label>
  </span>
  <span class="form-field-column">
  	#i18n{module.directory.gismap.loading}
  </span>
</div>
<div style="float:left; width:45%">
</div>

<input type="hidden" id="${entry.idEntry}_lngAddress" name="${entry.idEntry}_lngAddress" />
<input type="hidden" id="${entry.idEntry}_latAddress" name="${entry.idEntry}_latAddress" />

<div id="map_canvas" class="map" >
	<#include entry.gismapProvider.includeFile />
</div>
<div style="clear:both;"></div>

<script src="js/autocomplete/external/jquery/jquery.js"></script>
<script src="js/autocomplete/jquery-ui.js"></script>

<script>
	$("#${entry.idEntry}_address").autocomplete({
		source : function(request, reponse){ // les deux arguments représentent les données nécessaires au plugin
		$.ajax({
			url : "https://p89-ws.apps.paris.fr/SuggestPOI/rest/services/SuggestPOI.jsp",
		    dataType: "jsonp",
		    data: {
		    	clientId : "gismap",
				nbResults : 5, 
				query : request.term
		    },
		    success : function(data){
                reponse($.map(getResult(data.result), function(objet){
                	return objet;
                    
                }));
            }
        	});
    	},
    	select : function(event, ui){
    		$('#${entry.idEntry}_lngAddress').val(ui.item.x);
    		$('#${entry.idEntry}_latAddress').val(ui.item.y);
        }
	}).focus();
	function getResult(result) {
		var resultArray = [];
		var index;
		for	(index = 0; index < result.length; index++) {
			var object = new Object();
			object.value = result[index].libelleTypo;
			object.label = result[index].libelleTypo;
			object.x = result[index].x;
			object.y = result[index].y;
			resultArray.push(object);
		}
		return resultArray;	
    };
    	
</script>

<noscript>#i18n{module.genericattributes.gismap.javascript.disabled}</noscript>